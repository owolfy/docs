<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.26">
    <title>Error Handling | tsoa</title><meta name="description" content="">
    <link rel="preload" href="/docs/assets/js/runtime~app.473e5e82.js" as="script"><link rel="preload" href="/docs/assets/css/styles.71ed9e16.css" as="style"><link rel="preload" href="/docs/assets/js/540.8e2aff66.js" as="script"><link rel="preload" href="/docs/assets/js/app.549fea73.js" as="script">
    <link rel="stylesheet" href="/docs/assets/css/styles.71ed9e16.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/docs/" class=""><!----><span class="site-name">tsoa</span></a></span><div class="navbar-links-wrapper" style=""><!--[--><!--]--><nav class="navbar-links can-hide"><!--[--><div class="navbar-links-item"><a href="/docs/" class="nav-link" aria-label="Home"><!--[--><!--]--> Home <!--[--><!--]--></a></div><div class="navbar-links-item"><a href="/docs/introduction" class="nav-link" aria-label="Guides"><!--[--><!--]--> Guides <!--[--><!--]--></a></div><div class="navbar-links-item"><a class="nav-link external" href="https://tsoa-community.github.io/reference/index.html" rel="noopener noreferrer" target="_blank" aria-label="API Reference"><!--[--><!--]--> API Reference <span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span><!--[--><!--]--></a></div><div class="navbar-links-item"><a class="nav-link external" href="https://github.com/lukeautry/tsoa" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button class="toggle-dark-button" title="toggle dark mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><!----></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-links"><!--[--><div class="navbar-links-item"><a href="/docs/" class="nav-link" aria-label="Home"><!--[--><!--]--> Home <!--[--><!--]--></a></div><div class="navbar-links-item"><a href="/docs/introduction" class="nav-link" aria-label="Guides"><!--[--><!--]--> Guides <!--[--><!--]--></a></div><div class="navbar-links-item"><a class="nav-link external" href="https://tsoa-community.github.io/reference/index.html" rel="noopener noreferrer" target="_blank" aria-label="API Reference"><!--[--><!--]--> API Reference <span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span><!--[--><!--]--></a></div><div class="navbar-links-item"><a class="nav-link external" href="https://github.com/lukeautry/tsoa" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-links"><!--[--><!--[--><a href="/docs/introduction" class="nav-link sidebar-heading sidebar-item" aria-label="Introduction"><!--[--><!--]--> Introduction <!--[--><!--]--></a><!----><!--]--><!--[--><a href="/docs/getting-started" class="nav-link sidebar-heading sidebar-item" aria-label="Getting started"><!--[--><!--]--> Getting started <!--[--><!--]--></a><!----><!--]--><!--[--><p class="sidebar-heading sidebar-item active">Guides</p><ul class=""><li><!--[--><a href="/docs/generating.html" class="nav-link sidebar-item" aria-label="Generating Routes and OAS"><!--[--><!--]--> Generating Routes and OAS <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/docs/live-reloading.html" class="nav-link sidebar-item" aria-label="Live reloading"><!--[--><!--]--> Live reloading <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/docs/error-handling.html" class="router-link-active router-link-exact-active nav-link router-link-active sidebar-item active" aria-label="Error Handling"><!--[--><!--]--> Error Handling <!--[--><!--]--></a><ul class="sidebar-sub-items"><li><!--[--><a aria-current="page" href="/docs/error-handling.html#setting-up-error-handling" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="Setting up error handling"><!--[--><!--]--> Setting up error handling <!--[--><!--]--></a><ul class="sidebar-sub-items"><li><!--[--><a aria-current="page" href="/docs/error-handling.html#handling-validation-errors" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="Handling Validation Errors"><!--[--><!--]--> Handling Validation Errors <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/docs/error-handling.html#handling-missing-routes" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="Handling missing routes"><!--[--><!--]--> Handling missing routes <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--></li><li><!--[--><a aria-current="page" href="/docs/error-handling.html#specifying-error-response-types-for-openapi" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="Specifying error response types for OpenAPI"><!--[--><!--]--> Specifying error response types for OpenAPI <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/docs/error-handling.html#typechecked-alternate-responses" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="Typechecked alternate responses"><!--[--><!--]--> Typechecked alternate responses <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--></li><li><!--[--><a href="/docs/descriptions.html" class="nav-link sidebar-item" aria-label="Descriptions"><!--[--><!--]--> Descriptions <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/docs/examples.html" class="nav-link sidebar-item" aria-label="Examples"><!--[--><!--]--> Examples <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/docs/annotations.html" class="nav-link sidebar-item" aria-label="JSON Schema / tsoa keyword annotations"><!--[--><!--]--> JSON Schema / tsoa keyword annotations <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/docs/di.html" class="nav-link sidebar-item" aria-label="Dependency injection or IOC"><!--[--><!--]--> Dependency injection or IOC <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/docs/authentication.html" class="nav-link sidebar-item" aria-label="Authentication"><!--[--><!--]--> Authentication <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/docs/decorators.html" class="nav-link sidebar-item" aria-label="Decorators"><!--[--><!--]--> Decorators <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--><!--[--><a href="/docs/faq.html" class="nav-link sidebar-heading sidebar-item" aria-label="FAQ"><!--[--><!--]--> FAQ <!--[--><!--]--></a><!----><!--]--><!--[--><p class="sidebar-heading sidebar-item">Advanced Guides</p><ul class=""><li><!--[--><a href="/docs/file-upload.html" class="nav-link sidebar-item" aria-label="Uploading files"><!--[--><!--]--> Uploading files <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/docs/path-mapping.html" class="nav-link sidebar-item" aria-label="path-mapping"><!--[--><!--]--> path-mapping <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/docs/templates.html" class="nav-link sidebar-item" aria-label="Overriding route template"><!--[--><!--]--> Overriding route template <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/docs/routes.html" class="nav-link sidebar-item" aria-label="Consuming generated routes"><!--[--><!--]--> Consuming generated routes <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--><!--[--><a href="/docs/upgrading.html" class="nav-link sidebar-heading sidebar-item" aria-label="Upgrading from tsoa 2.5"><!--[--><!--]--> Upgrading from tsoa 2.5 <!--[--><!--]--></a><!----><!--]--><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><h1 id="error-handling" tabindex="-1"><a class="header-anchor" href="#error-handling" aria-hidden="true">#</a> Error Handling</h1><div class="custom-container warning"><p class="custom-container-title">COMPATIBILITY NOTE</p><p>This guide requires Node.js &gt;= 8 and will target <a href="https://expressjs.com" target="_blank" rel="noopener noreferrer">express<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a>. We currently recommend using <a href="https://yarnpkg.com/en/" target="_blank" rel="noopener noreferrer">Yarn<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a>, npm should work but was not tested. This guide assumes you followed the <a href="&#39;/getting-started&#39;">getting started guide</a> or have a similar setup.</p></div><p>As you may have noticed after following all the steps from the <a href="&#39;/getting-started&#39;">getting started guide</a>, our server does not allow for invalid parameters, but the response isn&#39;t very ideal yet.</p><p><img src="/docs/assets/img/errors-server.b6c2a084.png" alt="Current Error Response"></p><p>For the Client, it looks something like this:</p><p><img src="/docs/assets/img/errors-client.e2566231.png" alt="Client Error Response"></p><h2 id="setting-up-error-handling" tabindex="-1"><a class="header-anchor" href="#setting-up-error-handling" aria-hidden="true">#</a> Setting up error handling</h2><h3 id="handling-validation-errors" tabindex="-1"><a class="header-anchor" href="#handling-validation-errors" aria-hidden="true">#</a> Handling Validation Errors</h3><p>Let&#39;s first make sure that, whenever the Client triggers a Validation Error, instead of printing the stack trace, instead we show a properly formatted json response.</p><p>At the end of our <code>app.ts</code>, after the call to <code>RegisterRoutes(app)</code>, we&#39;ll add a global express error handler:</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">import</span> express<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  Response <span class="token keyword">as</span> ExResponse<span class="token punctuation">,</span>
  Request <span class="token keyword">as</span> ExRequest<span class="token punctuation">,</span>
  NextFunction<span class="token punctuation">,</span>
<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;express&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> ValidateError <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;tsoa&quot;</span><span class="token punctuation">;</span>
<span class="token comment">// ...</span>

app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">errorHandler</span><span class="token punctuation">(</span>
  err<span class="token operator">:</span> <span class="token builtin">unknown</span><span class="token punctuation">,</span>
  req<span class="token operator">:</span> ExRequest<span class="token punctuation">,</span>
  res<span class="token operator">:</span> ExResponse<span class="token punctuation">,</span>
  next<span class="token operator">:</span> NextFunction
<span class="token punctuation">)</span><span class="token operator">:</span> ExResponse <span class="token operator">|</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>err <span class="token keyword">instanceof</span> <span class="token class-name">ValidateError</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Caught Validation Error for </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>req<span class="token punctuation">.</span>path<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">:</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> err<span class="token punctuation">.</span>fields<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">422</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      message<span class="token operator">:</span> <span class="token string">&quot;Validation Failed&quot;</span><span class="token punctuation">,</span>
      details<span class="token operator">:</span> err<span class="token operator">?.</span>fields<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>err <span class="token keyword">instanceof</span> <span class="token class-name">Error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      message<span class="token operator">:</span> <span class="token string">&quot;Internal Server Error&quot;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><p>Now, the same request will respond like this:</p><p><img src="/docs/assets/img/errors-json-client.ea2bf845.png" alt="Client Error with handler"></p><p>Additionally, our console will show:</p><p><img src="/docs/assets/img/errors-json-server.19f38e59.png" alt="Server Error with handler"></p><h3 id="handling-missing-routes" tabindex="-1"><a class="header-anchor" href="#handling-missing-routes" aria-hidden="true">#</a> Handling missing routes</h3><p>In order to handle missing urls more gracefully, we can add a &quot;catch-all&quot; route handler:</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token comment">// app.ts</span>
<span class="token keyword">import</span> express<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  Response <span class="token keyword">as</span> ExResponse<span class="token punctuation">,</span>
  Request <span class="token keyword">as</span> ExRequest<span class="token punctuation">,</span>
  NextFunction<span class="token punctuation">,</span>
<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;express&quot;</span><span class="token punctuation">;</span>

<span class="token comment">// ...</span>

<span class="token function">RegisterRoutes</span><span class="token punctuation">(</span>app<span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">notFoundHandler</span><span class="token punctuation">(</span>_req<span class="token punctuation">,</span> res<span class="token operator">:</span> ExResponse<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">404</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    message<span class="token operator">:</span> <span class="token string">&quot;Not Found&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">errorHandler</span><span class="token punctuation">(</span>
<span class="token comment">// ...</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><h2 id="specifying-error-response-types-for-openapi" tabindex="-1"><a class="header-anchor" href="#specifying-error-response-types-for-openapi" aria-hidden="true">#</a> Specifying error response types for OpenAPI</h2><p>If you check out the Documentation endpoint, you&#39;ll notice that we don&#39;t have any documentation for our Errors yet. Since TypeScript does not check throwing Errors, tsoa can&#39;t infer the type of response we&#39;re sending out in these cases.</p><div class="custom-container warning"><p class="custom-container-title">WARNING</p><p>Please note that <code>@Response</code> has to be the tsoa import and can not currently be renamed (i.e. <code>import {Response as TsoaResponse} from &quot;tsoa&quot;</code>)</p></div><p>However, we have a way for you to manually specify these returns:</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Body<span class="token punctuation">,</span> Controller<span class="token punctuation">,</span> Post<span class="token punctuation">,</span> Route<span class="token punctuation">,</span> Response<span class="token punctuation">,</span> SuccessResponse <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;tsoa&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> User <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;./user&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> UsersService<span class="token punctuation">,</span> UserCreationParams <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;./usersService&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">interface</span> <span class="token class-name">ValidateErrorJSON</span> <span class="token punctuation">{</span>
  message<span class="token operator">:</span> <span class="token string">&quot;Validation failed&quot;</span><span class="token punctuation">;</span>
  details<span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token punctuation">[</span>name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token builtin">unknown</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">Route</span></span><span class="token punctuation">(</span><span class="token string">&quot;users&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">UsersController</span> <span class="token keyword">extends</span> <span class="token class-name">Controller</span> <span class="token punctuation">{</span>
  <span class="token comment">// more code here</span>

  <span class="token decorator"><span class="token at operator">@</span><span class="token function">Response</span></span><span class="token operator">&lt;</span>ValidateErrorJSON<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token number">422</span><span class="token punctuation">,</span> <span class="token string">&quot;Validation Failed&quot;</span><span class="token punctuation">)</span>
  <span class="token decorator"><span class="token at operator">@</span><span class="token function">SuccessResponse</span></span><span class="token punctuation">(</span><span class="token string">&quot;201&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Created&quot;</span><span class="token punctuation">)</span> <span class="token comment">// Custom success response</span>
  <span class="token decorator"><span class="token at operator">@</span><span class="token function">Post</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">public</span> <span class="token keyword">async</span> <span class="token function">createUser</span><span class="token punctuation">(</span>
    <span class="token decorator"><span class="token at operator">@</span><span class="token function">Body</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> requestBody<span class="token operator">:</span> UserCreationParams
  <span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token keyword">void</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setStatus</span><span class="token punctuation">(</span><span class="token number">201</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// set return status 201</span>
    <span class="token keyword">new</span> <span class="token class-name">UsersService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>requestBody<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><p>This should make our docs show something like this:</p><p><img src="/docs/assets/img/err-422-swui.7e4aca66.png" alt="SwaggerUI showing our 422 Response"></p><div class="custom-container tip"><p class="custom-container-title">TIP</p><p>OpenAPI allows matching status codes such as &#39;2xx&#39; or matching all codes using &#39;default&#39;. tsoa will support this:</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token decorator"><span class="token at operator">@</span><span class="token function">Response</span></span><span class="token operator">&lt;</span>ErrorResponse<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token string">&#39;default&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;Unexpected error&#39;</span><span class="token punctuation">)</span>
<span class="token decorator"><span class="token at operator">@</span><span class="token function">Get</span></span><span class="token punctuation">(</span><span class="token string">&#39;Response&#39;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">async</span> <span class="token function">getResponse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span>TestModel<span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ModelService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getModel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></div><h2 id="typechecked-alternate-responses" tabindex="-1"><a class="header-anchor" href="#typechecked-alternate-responses" aria-hidden="true">#</a> Typechecked alternate responses</h2><div class="custom-container warning"><p class="custom-container-title">WARNING</p><p>This section applies to tsoa &gt;=3.1</p></div><p>In recent versions of tsoa, we have the option to inject a framework-agnostic responder function into our function that we can call to formulate a response that does not comply with the return type of our controller method/status code and headers (which is used for the success response). This is especially useful to reply with an error response without the risk of type mismatches associated with throwing errors. In order to inject one/more responders, we can use the <code>@Res()</code> decorator:</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Route<span class="token punctuation">,</span> Controller<span class="token punctuation">,</span> Get<span class="token punctuation">,</span> Query<span class="token punctuation">,</span> Res<span class="token punctuation">,</span> TsoaResponse <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;tsoa&#39;</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">Route</span></span><span class="token punctuation">(</span><span class="token string">&#39;/greeting&#39;</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">GreetingsController</span> <span class="token keyword">extends</span> <span class="token class-name">Controller</span> <span class="token punctuation">{</span>
  <span class="token doc-comment comment">/**
   * <span class="token keyword">@param</span> <span class="token parameter">notFoundResponse</span> The responder function for a not found response
   */</span>
  <span class="token decorator"><span class="token at operator">@</span><span class="token function">Get</span></span><span class="token punctuation">(</span><span class="token string">&#39;/&#39;</span><span class="token punctuation">)</span>
  <span class="token keyword">public</span> <span class="token keyword">async</span> <span class="token function">greet</span><span class="token punctuation">(</span><span class="token decorator"><span class="token at operator">@</span><span class="token function">Query</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> name<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token decorator"><span class="token at operator">@</span><span class="token function">Res</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> notFoundResponse<span class="token operator">:</span> TsoaResponse<span class="token operator">&lt;</span><span class="token number">404</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> reason<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token function">notFoundResponse</span><span class="token punctuation">(</span><span class="token number">404</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> reason<span class="token operator">:</span> <span class="token string">&quot;We don&#39;t know you yet. Please provide a name&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Hello, </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><!--]--></div><footer class="page-meta"><!----><div class="meta-item last-updated"><span class="meta-item-label">Last Updated: </span><span class="meta-item-info">10/2/2021, 12:48:43 PM</span></div><div class="meta-item contributors"><span class="meta-item-label">Contributors: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: wolfgang.hobmaier@sensoring.de">WoH</span><!--[-->, <!--]--><!--]--><!--[--><span class="contributor" title="email: adam.gilman@gmail.com">Adam Gilman</span><!--[-->, <!--]--><!--]--><!--[--><span class="contributor" title="email: mail@mathiswiehl.de">Mathis Wiehl</span><!----><!--]--><!--]--></span></div></footer><nav class="page-nav"><p class="inner"><span class="prev"> ← <a href="/docs/live-reloading.html" class="nav-link" aria-label="Live reloading"><!--[--><!--]--> Live reloading <!--[--><!--]--></a></span><span class="next"><a href="/docs/descriptions.html" class="nav-link" aria-label="Descriptions"><!--[--><!--]--> Descriptions <!--[--><!--]--></a> → </span></p></nav><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script src="/docs/assets/js/runtime~app.473e5e82.js" defer></script><script src="/docs/assets/js/540.8e2aff66.js" defer></script><script src="/docs/assets/js/app.549fea73.js" defer></script>
  </body>
</html>
